edit_spell.html:
{% extends "DnDSite/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/edit_spell.css' %}">
{% endblock %}

{% block extra_js %}
<script src="/static/js/edit_spell.js"></script>
{% endblock %}
{% block title %}Редактирование заклинания: {{ spell.name }} - D&D Справочник{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-5 fw-bold">
                <i class="bi bi-pencil text-warning"></i> Редактирование заклинания
            </h1>
            <p class="lead text-muted">Измените характеристики "{{ spell.name }}"</p>

            {% if spell.is_homebrew and not spell.is_approved %}
            <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle"></i> Это заклинание ожидает одобрения администратора.
            </div>
            {% endif %}

            {% if spell.is_homebrew and not is_admin %}
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> После сохранения изменений заклинание будет отправлено на повторное рассмотрение администратором.
            </div>
            {% endif %}
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow border-0">
                <div class="card-header bg-primary text-white py-3">
                    <h3 class="mb-0"><i class="bi bi-stars"></i> Редактирование заклинания</h3>
                </div>

                <div class="card-body p-4">
                    <form method="post" id="spellForm" novalidate>
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                            <p class="mb-0">{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <div class="row g-3">
                            <div class="col-md-8">
                                <div class="form-floating mb-3">
                                    {{ form.name }}
                                    <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
                                    {% if form.name.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.name.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-floating mb-3">
                                    {{ form.level }}
                                    <label for="{{ form.level.id_for_label }}">{{ form.level.label }}</label>
                                    {% if form.level.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.level.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    {{ form.school }}
                                    <label for="{{ form.school.id_for_label }}">{{ form.school.label }}</label>
                                    {% if form.school.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.school.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    {{ form.casting_time }}
                                    <label for="{{ form.casting_time.id_for_label }}">{{ form.casting_time.label }}</label>
                                    {% if form.casting_time.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.casting_time.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    {{ form.spell_range }}
                                    <label for="{{ form.spell_range.id_for_label }}">{{ form.spell_range.label }}</label>
                                    {% if form.spell_range.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.spell_range.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    {{ form.duration }}
                                    <label for="{{ form.duration.id_for_label }}">{{ form.duration.label }}</label>
                                    {% if form.duration.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.duration.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-12">
                                <div class="form-floating mb-3">
                                    {{ form.desc }}
                                    <label for="{{ form.desc.id_for_label }}">{{ form.desc.label }}</label>
                                    <div class="form-text">Подробное описание эффектов заклинания</div>
                                    {% if form.desc.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ form.desc.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-12">
                                <h5 class="mt-4 mb-3">Специальные свойства</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check form-switch mb-3">
                                            {{ form.ritual }}
                                            <label class="form-check-label" for="{{ form.ritual.id_for_label }}">
                                                {{ form.ritual.label }}
                                            </label>
                                            <div class="form-text">Можно накладывать как ритуал</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check form-switch mb-3">
                                            {{ form.concentration }}
                                            <label class="form-check-label" for="{{ form.concentration.id_for_label }}">
                                                {{ form.concentration.label }}
                                            </label>
                                            <div class="form-text">Требует концентрации</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12">
                                <h5 class="mt-4 mb-3">Компоненты</h5>
                                <div class="row">
                                    {% for value, label in component_choices %}
                                    <div class="col-md-4">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox"
                                                   name="components" value="{{ value }}"
                                                   id="component_{{ value }}"
                                                   {% if value in current_components %}checked{% endif %}>
                                            <label class="form-check-label" for="component_{{ value }}">
                                                {{ label }}
                                            </label>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% if is_admin and 'is_approved' in form.fields %}
                            <div class="col-12">
                                <div class="form-check form-switch mb-3">
                                    {{ form.is_approved }}
                                    <label class="form-check-label fw-bold text-success" for="{{ form.is_approved.id_for_label }}">
                                        <i class="bi bi-check-circle"></i> Одобрено администратором
                                    </label>
                                    <div class="form-text">Отметьте, чтобы сразу опубликовать заклинание</div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="d-flex justify-content-between mt-5">
                            <a href="{% url 'spell_detail' spell.id %}" class="btn btn-outline-secondary">
                                <i class="bi bi-x-circle"></i> Отмена
                            </a>
                            <div class="btn-group">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="bi bi-save"></i> Сохранить изменения
                                </button>
                                {% if spell.is_homebrew and is_admin %}
                                <a href="{% url 'delete_spell' spell.id %}" class="btn btn-outline-danger btn-lg">
                                    <i class="bi bi-trash"></i> Удалить
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card mt-4 border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Информация о заклинании</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="bi bi-calendar"></i> История изменений</h6>
                            <ul class="list-unstyled">
                                <li><strong>Создано:</strong> {{ spell.created_at|date:"d.m.Y H:i" }}</li>
                                {% if spell.created_by %}
                                <li><strong>Автор:</strong> {{ spell.created_by.username }}</li>
                                {% endif %}
                                <li><strong>Тип:</strong> {% if spell.is_homebrew %}Homebrew{% else %}Официальное{% endif %}</li>
                                <li><strong>Статус:</strong>
                                    {% if spell.is_approved %}
                                        <span class="badge bg-success">Одобрено</span>
                                    {% else %}
                                        <span class="badge bg-warning">Ожидает одобрения</span>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}Ц